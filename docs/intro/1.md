# guide

- https://juejin.cn/post/7205928315587477562
- [从nest.js中了解IoC和DI的实现](https://qborfy.com/2023/01/22/today/20220122/)

Nest.js的核心是基于IoC控制反转 + DI 依赖注入 去实现类的声明和实例化的。如果你了解过Spring Boot其实很容易上手nest.js。

## 基础概念

### Module

Module 其实是nest.js用来将一个web应用拆分成各个子模块的分类规定，web应用根模块一般叫app.module.ts，官方设计图如下：


Module应该由以下几个部分组成：

- providers： 允许交给模块实例化的类，包括不限于Service等
- controllers：必须实例的controller类
- imports： 模块依赖其他模块
- exports：模块对外提供的方法类

### Controller

Controller就一个作用，分割路由，调用处理方法，返回http请求结果。

### Provider

Provider其实就是不仅仅是Service层，还包括：Sql的Dao层、工具方法等提供。它和其他层关系如下图：

写法：

- `@Injectable()` 声明该类是一个Provider，允许其他类实现依赖注入
- `@Optional()` 允许构造不传
- `@Inject()` 自动依赖注入

## Middleware

Middleware中间件，其实和egg.js的中间件概念一样，就是当http请求来了之后，被中间件处理一遍之后才会到对应的Controller层。

写法：

implements NestMiddleware，必须实现NestMiddleware接口，以及内部方法use(req: Request, res: Response, next: NextFunction)，同时内部方法必须调用next

在Module层注册中间件，这里需要可以设置

## ExceptionFilter

Filter过滤器，这个应该是所有web框架都具备的功能，拦截用户请求和web返回数据。

在Nest.js中，只实现ExeptionFilter，你也可以基于这个去自定义自己的异常过滤器，具体如下图：

写法：

- @Catch(HttpException) class HttpExceptionFilter implements ExceptionFilter 实现自定义异常过滤器
- @UseFilters(new HttpExceptionFilter()) 能给具体接口包裹上一层自定义的异常过滤器

## Pipe

Pipe 管道流，是指的Http请求里的内容数据流，它支持数据验证、数据转换等功能，有点类似Filter的功能。

## Guard

Guard 守卫，也是处Http请求中的一层特殊中间件，但是与中间件不同的时候，中间件不知道next()是去哪个执行代码，而Guard则可以获取ExecutionContext实例，可以获知整个请求的生命周期和内置内容，通常用来接口登录和权限控制。

## Interceptor

Interceptor是面向切面编程理念影响的概念，它允许你在方法执行前后扩展原有函数功能，如：改变返回结果，扩展基本功能等，常用的场景：添加常规日志。

## 其他

自定义参数装饰器createParamDecorator，可以从request对象中抽取固定的参数。

applyDecorators 可以将多个装饰器 方法合在一起验证，然后形成一个新的注装饰器
